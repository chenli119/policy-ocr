# Vercel 跨域代理服务 - 项目笔记

## 📋 项目概述

**项目名称**: Vercel 跨域代理服务  
**创建时间**: 2024年  
**项目目标**: 解决前端跨域问题，提供简单易用的代理服务  

## 🎯 核心功能需求

### 1. 基础功能
- ✅ 通过 `?url=目标地址` 接收前端传入的 URL
- ✅ 转发 GET 请求并返回结果
- ✅ 支持多种响应格式（JSON、文本、二进制）

### 2. 跨域处理
- ✅ 设置 `Access-Control-Allow-Origin: *` 允许所有域名访问
- ✅ 支持预检请求（OPTIONS）
- ✅ 设置完整的 CORS 头信息

### 3. 安全校验
- ✅ 使用 `new URL(url)` 验证目标地址格式
- ✅ 协议限制：只允许 HTTP 和 HTTPS
- ✅ 请求超时控制（10秒）
- ✅ 完善的错误处理机制

## 🏗️ 技术架构

### 技术栈
- **运行环境**: Node.js 18+
- **部署平台**: Vercel Serverless Functions
- **API 类型**: RESTful API
- **请求方法**: GET

### 项目结构
```
.
├── api/
│   └── proxy.js          # 核心代理服务
├── package.json          # 项目配置
├── vercel.json          # Vercel 部署配置
├── README.md            # 使用文档
├── example.html         # 测试页面
└── 项目笔记.md          # 项目笔记
```

## 🔧 实现细节

### 1. 核心代理逻辑
```javascript
// 主要实现在 api/proxy.js
- 参数验证和URL格式检查
- CORS 头设置
- fetch 请求转发
- 响应类型处理
- 错误处理和状态码返回
```

### 2. 安全措施
- **URL 验证**: 使用 `new URL()` 构造函数验证
- **协议限制**: 只允许 `http:` 和 `https:`
- **超时控制**: 使用 `AbortSignal.timeout(10000)`
- **错误分类**: 区分不同类型的错误并返回相应状态码

### 3. 响应处理
- **JSON 响应**: 自动解析并转发 JSON 数据
- **文本响应**: 直接转发文本内容
- **二进制响应**: 使用 Buffer 处理二进制数据
- **Content-Type**: 保持原始响应的内容类型

## 📊 API 接口文档

### 请求格式
```
GET /api/proxy?url={目标地址}
```

### 响应状态码
- `200`: 请求成功
- `400`: 参数错误或 URL 格式无效
- `405`: 请求方法不支持
- `408`: 请求超时
- `502`: 目标服务器连接失败
- `500`: 服务器内部错误

### 使用示例
```javascript
// 基础用法
fetch('https://your-project.vercel.app/api/proxy?url=https://api.example.com/data')
  .then(response => response.json())
  .then(data => console.log(data));
```

## 🚀 部署流程

### 1. 准备工作
- 安装 Vercel CLI: `npm install -g vercel`
- 登录 Vercel 账户: `vercel login`

### 2. 部署步骤
1. 在项目根目录执行 `vercel --prod`
2. 按照提示配置项目设置
3. 获得部署后的域名地址

### 3. 本地开发
- 本地测试: `vercel dev`
- 访问: `http://localhost:3000/api/proxy`

## 🧪 测试方案

### 1. 测试页面
- 创建了 `example.html` 测试页面
- 提供可视化界面测试代理功能
- 包含多个示例 URL 进行测试

### 2. 测试用例
- ✅ 正常 JSON API 请求
- ✅ 文本内容请求
- ✅ 错误 URL 格式处理
- ✅ 超时请求处理
- ✅ 不支持的协议处理

## 📈 性能优化

### 1. Vercel 配置优化
- 设置函数最大执行时间为 10 秒
- 配置全局 CORS 头
- 利用 Vercel Edge Network 加速

### 2. 代码优化
- 使用原生 fetch API，减少依赖
- 流式处理大文件响应
- 合理的错误处理避免资源泄露

## 🔍 监控和维护

### 1. 错误监控
- 完善的错误分类和日志记录
- 不同错误类型返回对应的 HTTP 状态码
- 控制台错误日志输出

### 2. 使用限制
- Vercel 免费版有请求次数限制
- 单次请求最大执行时间 10 秒
- 响应大小受 Vercel 平台限制

## 🎉 项目成果

### 已完成功能
- ✅ 核心代理服务实现
- ✅ 完整的 CORS 支持
- ✅ 安全验证机制
- ✅ 错误处理和状态码
- ✅ 多种响应格式支持
- ✅ 部署配置文件
- ✅ 使用文档和示例
- ✅ 可视化测试页面

### 项目特色
- 🚀 **零配置部署**: 直接部署到 Vercel
- 🌐 **全球加速**: 利用 Vercel CDN
- 🔒 **安全可靠**: 多重安全验证
- 📱 **响应式**: 支持各种设备访问
- 🧪 **易于测试**: 提供测试页面

## 📝 后续改进建议

1. **功能增强**
   - 支持 POST、PUT、DELETE 等其他 HTTP 方法
   - 添加请求头转发功能
   - 支持请求体数据转发

2. **安全加强**
   - 添加域名白名单功能
   - 实现 API 密钥认证
   - 添加请求频率限制

3. **监控优化**
   - 集成日志分析服务
   - 添加性能监控
   - 实现请求统计功能

---

**项目状态**: ✅ 已完成  
**最后更新**: 2024年  
**维护状态**: 活跃维护中